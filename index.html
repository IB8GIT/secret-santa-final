<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Secret Santa Wheel</title>

  <!-- Mobile friendly -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;

    background: url("secret_santa.jpg") no-repeat center center fixed;
    background-size: cover;
    }

    h1 {
      font-size: 2em;
    }

    input {
      padding: 10px;
      width: 80%;
      max-width: 300px;
      font-size: 16px;
    }

    button {
      /* padding: 12px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer; */
      
    background-color: #75e0c9; /* Green background */
    color: rgb(221, 15, 15);              /* White text */
    padding: 12px 24px;         /* Space inside button */
    border: none;               /* Remove default border */
    margin: 10px;
    border-radius: 12px;        /* Rounded corners */
    cursor: pointer;            /* Pointer on hover */
    font-size: 16px;            /* Text size */
    transition: background-color 0.3s ease; /* Smooth hover effect */
    }

    #result {
      font-size: 22px;
      margin-top: 20px;
      font-weight: bold;
      color: #fdfdfd;
    }

    ul {
      list-style: none;
      padding: 0;
    }

    li {
      background: #f2f2f2;
      margin: 5px auto;
      padding: 8px;
      max-width: 300px;
      border-radius: 5px;
      display: none;
    }
    h3 {
        display: none;
    }

    canvas {
    margin: 20px auto;
    display: block;
    
    }


  </style>
</head>

<body>

  <h1>üéÅ Become a Secret Santa </h1>

  <br>
  <br>

  <div id="result">Please select your name then Click on Spin Button!</div>
  <br>
  <!-- <input id="emailInput" placeholder="Company Email" />
    <br> -->
  <!-- <input id="userNameInput" placeholder="Your Name" /> -->

  <!-- <input id="nameInput" placeholder="Enter name" /> -->
  <select id="userNameSelect">
    <option value="">-- Select Your Name --</option>
  </select>
  <br><br>

    <!-- <div id="result">Please Enter your info and then Click on Spin Button!</div> -->
  <!-- <button onclick="addName()">Add Name</button> -->
  <button onclick="spinWheel()">Spin üé°</button>



  <canvas id="wheel" width="300" height="300"></canvas>

  <h3>Names on the Wheel</h3>
  <ul id="nameList"></ul>

<script>
  const canvas = document.getElementById("wheel");
  const ctx = canvas.getContext("2d");

  let names = [ "Dr Suresh Singh",
  "Rakesh Kumar",
  "Rita Singh",
  "Shubhanjali Srivastava",
  "Janak Tiwari",
  "Chinmaya Pradhan",
  "Ankit Yadav",
  "Adarsh Prakash Pandey",
  "Basit Bashir",
  "Dinesh Kumar",
  "Dilip Nehara",
  "Tarun Bharti",
  "Nitish Kumar",
  "Manish Kumar",
  "Ritik Srivastava",
  "Rishi Kumar",
  "Sarthak Singh",
  "Mrityunjay Gupta",
  "Anurag Mishra",
  "Ibrar Hussain",
  "Deepak Meena" ];

  let angle = 0;
  let spinning = false;

  // function addName() {
  //   const input = document.getElementById("nameInput");
  //   const name = input.value.trim();
  //   if (name === "") return;

  //   names.push(name);
  //   input.value = "";
  //   drawWheel();
  //   updateList();
  // }

  function drawWheel() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (names.length === 0) return;

    const slice = (2 * Math.PI) / names.length;

    names.forEach((name, i) => {
      const start = angle + i * slice;
      const end = start + slice;

      ctx.beginPath();
      ctx.moveTo(150, 150);
      ctx.arc(150, 150, 140, start, end);
      ctx.fillStyle = i % 2 === 0 ? "#ffcc66" : "#ff9966";
      ctx.fill();
      ctx.stroke();

      ctx.save();
      ctx.translate(150, 150);
      ctx.rotate(start + slice / 2);
      ctx.textAlign = "right";
      ctx.fillStyle = "#000";
      ctx.font = "14px Arial";
      ctx.fillText(name, 130, 5);
      ctx.restore();
    });
  }

  function spinWheel() {

    // üîí VALIDATION FIRST
    const userName = document.getElementById("userNameSelect").value;

    if (!userName) {
      alert("Please select your name");
      return;
    }

    if (spinning || names.length === 0) return;

    spinning = true;
    let speed = Math.random() * 0.3 + 0.25;

    const spin = setInterval(() => {
      angle += speed;
      speed *= 0.97;

      drawWheel();

      if (speed < 0.01) {
        clearInterval(spin);
        spinning = false;

        const slice = (2 * Math.PI) / names.length;
        const index =
          names.length -
          Math.floor(((angle % (2 * Math.PI)) / slice)) -
          1;

        const selected = names[index];
        names.splice(index, 1);

        // üîÑ Update dropdown after removing name
        populateUserDropdown();

        document.getElementById("result").innerText =
          "Secret Santa For: üéÅ " + selected;

        // üîê SEND DATA TO BACKEND
        // fetch("https://script.google.com/macros/s/AKfycbwFFtBGPrK_rfjPSQx3Jsk2CgArCk_kDMaCOSxEjAhTubTTxwr9KB2X-mf79k5aZLtJ/exec", {
        // fetch("https://script.google.com/macros/s/AKfycbyk9pWpNUzJCiZYm5d8AC43f_x5exzlbiSSI4pSvGI/dev", {
        //   method: "POST",
        //   headers: {
        //     "Content-Type": "application/json"
        //   },
        //   body: JSON.stringify({
        //     name: userName,
        //     result: selected
        //   })
        // })
        // .then(res => res.json())
        // .then(data => {
        //   console.log("Server response:", data);

        //   if (data.status === "DENIED") {
        //     alert("You have already spun the wheel!");
        //     location.reload();
        //   }

        //   if (data.status === "ERROR") {
        //     alert("Server error: " + data.message);
        //   }
        // })
        // .catch(err => {
        //   console.error("Fetch failed:", err);
        // });

        // fetch("https://script.google.com/macros/s/AKfycbzajlOCRGeLa2Jnts2OMKTGohgAo_ZxTsbrFYWOfQ4FMnULS5bDAhtDlJRT3IZ_Hj_F/exec", {
        
        //----------------------------------------------------Fetch again----------------------------------
        // fetch("https://script.google.com/macros/s/AKfycbzajlOCRGeLa2Jnts2OMKTGohgAo_ZxTsbrFYWOfQ4FMnULS5bDAhtDlJRT3IZ_Hj_F/exec", {
        // method: "POST",
        // headers: {
        //     "Content-Type": "application/json"
        // },
        // body: JSON.stringify({
        //     name: userName,
        //     result: selected
        // })
        // })
        // .then(res => res.json())
        // .then(data => {
        // console.log("Server response:", data);

        // if (data.status === "DENIED") {
        //     alert("You have already spun the wheel!");
        //     location.reload();
        // }

        // if (data.status === "ERROR") {
        //     alert("Server error: " + data.message);
        // }
        // })
        // .catch(err => console.error(err));

        //-------------------------------------------------------------------------------------------------------
        // fetch("https://script.google.com/macros/s/AKfycbzajlOCRGeLa2Jnts2OMKTGohgAo_ZxTsbrFYWOfQ4FMnULS5bDAhtDlJRT3IZ_Hj_F/exec", {
        //fetch("https://script.google.com/macros/s/AKfycbyFZKOGJ3HxBQaRa-cjYcse51ZtlOT4SJeg-XY-2eyRot5Vtm8T7CH5MdLgcPCFn6HB1A/exec", {
        fetch("https://script.google.com/macros/s/AKfycbxJORSkurV5grZxJ28sPodfVdZ7kgPVJ58GU6qQJsbrJoKRUlV-c0lWBX3oEKREELn_hg/exec",{
        method: "POST",
        body: JSON.stringify({
            name: userName,
            result: selected
        })
        })
        .then(res => res.json())
        .then(data => {
        console.log("Server response:", data);

        if (data.status === "DENIED") {
            alert("You have already spun the wheel!");
            location.reload();
        }

        if (data.status === "ERROR") {
            alert("Server error: " + data.message);
        }
        })
        .catch(err => console.error(err));



        drawWheel();
        updateList();
      }
    }, 30);
  }


  function updateList() {
    const list = document.getElementById("nameList");
    list.innerHTML = "";
    names.forEach(n => {
      const li = document.createElement("li");
      li.textContent = n;
      list.appendChild(li);
    });
  }

  function populateUserDropdown() {
  const select = document.getElementById("userNameSelect");
  select.innerHTML = '<option value="">-- Select Your Name --</option>';

  names.forEach(name => {
    const option = document.createElement("option");
    option.value = name;
    option.textContent = name;
    select.appendChild(option);
  });
  }
  populateUserDropdown();
  drawWheel();
  updateList();
</script>



</body>
</html>
